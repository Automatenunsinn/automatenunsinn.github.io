(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(){return"undefined"==typeof window||!window.location.hostname.includes("astl")}e.r(t),e.d(t,{PATCH_DATA_CHECKSUM_PATTERN:()=>u,PATCH_DATA_CHECKSUM_VALUE:()=>h,PATCH_DATA_DATE_PATTERN:()=>s,PATCH_DATA_DATE_VALUE:()=>y,PATCH_DATA_DATUM_UHR_PATTERN:()=>T,PATCH_DATA_FIXED:()=>w,PATCH_DATA_INITRAM1_PATTERN:()=>f,PATCH_DATA_INITRAM1_VALUE:()=>A,PATCH_DATA_INITRAM2_PATTERN:()=>p,PATCH_DATA_INITRAM2_VALUE:()=>U,PATCH_DATA_ZULASSUNG_PATTERN:()=>g,PATCH_DATA_ZULASSUNG_VALUE:()=>m,convertDate:()=>_});var r=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{o(n.next(e))}catch(e){i(e)}},l=e=>{try{o(n.throw(e))}catch(e){i(e)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);o((n=n.apply(e,t)).next())});let i=new Uint8Array,a=0,l=!1,o="",c="",d="";const u=new Uint8Array([176,144,103,14]),h=new Uint8Array([32,16,96,14]),s=new Uint8Array([112,2,47,0,112,16,47,0,78,185,0,0]),y=new Uint8Array([112,2,47,0,112,16,47,0,78,185,0,15,255,4]),g=new Uint8Array([47,10,112,1,47,0,112,16,47,0,78,185,0,0]),m=new Uint8Array([47,10,112,1,47,0,112,16,47,0,78,185,0,15,255,12]),f=new Uint8Array([79,239,0,12,54,188,0,1]),A=new Uint8Array([79,239,0,12,54,188,0,2]),p=new Uint8Array([79,239,0,12,54,188,0,1]),U=new Uint8Array([79,239,0,12,54,188,0,2]),T=(new TextEncoder).encode("DATUM - UHR    "),w=new Uint8Array([49,18,16,0,32,60,0,15,255,0,78,117,48,47,0,6,34,47,0,8,78,77,78,113,12,128,18,52,86,120,103,6,6,128,0,169,138,199,78,117]);let D=new Uint8Array,S=null,P=null,R=null;function b(e){console.log(`[STATUS] ${e}`),S&&(S.textContent=e,S.style.color=e.startsWith("Suche")||e.startsWith("Muster gefunden")?"inherit":"#007bff"),e.startsWith("Suche")||e.startsWith("Muster gefunden")||console.log(`[STATUS] ${e}`)}function $(e,t,n=!1){return r(this,null,function*(){R&&(R.value=e,b(t),R.className=n?"failure":"success"),yield new Promise(e=>setTimeout(e,1))})}function _(e){try{if(8===e.length){const t=parseInt(e.substring(0,4)),n=parseInt(e.substring(4,6)),r=parseInt(e.substring(6,8)),i=e=>Math.floor(e/10)<<4|e%10;return new Uint8Array([i(r),i(n),i(t%100),0])}}catch(e){console.warn("Invalid date format:",e)}return new Uint8Array([0,0,0,0])}function M(){if(0===i.length)return;b("Byte-Paare tauschen...");const e=new Uint8Array(i);for(let t=0;t<e.length-1;t+=2){const n=e[t];e[t]=e[t+1],e[t+1]=n,Math.floor(t/e.length*100)}i=e,b("Byte-Tausch abgeschlossen"),E()}function E(){if(!P)return;let e="";i.length>0?(e=`ROM Größe: ${i.length} bytes`,e+=l?`<br>Modus: Duale 8-Bit geladen<br>ODD: ${o}<br>EVEN: ${c}`:`<br>Modus: 16-Bit geladen<br>Datei: ${d}`):e="Keine ROM geladen",P.innerHTML=e}function I(e){return r(this,null,function*(){if(0===i.length||0===e.length||e.length>=50)return-1;const t=e.length;for(let r=0;r<=i.length-t;r+=2){b(`Suche... ${Math.floor(r/i.length*100)}%`),r%2e3==0&&(yield new Promise(e=>setTimeout(e,1)));let a=n();for(let n=0;n<t;n++)if(i[r+n]!==e[n]){a=!1;break}if(a)return b(`Muster gefunden bei 0x${r.toString(16).toUpperCase()}`),r}return b("Muster nicht gefunden"),-1})}function C(e,t){return r(this,null,function*(){if(t<=0||t>=50||0===D.length)return b("Ungültige Patch-Länge oder keine Patch-Daten"),void(yield $(0,"Fehler: Ungültige Patch-Daten",!0));if(e+t>i.length){const n=new Uint8Array(e+t);n.set(i),i=n}const n=D,r=Math.min(t,n.length);for(let t=0;t<r;t++)i[e+t]=n[t]})}"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",()=>{S=document.getElementById("statusText"),P=document.getElementById("romInfo"),R=document.getElementById("progressBar");const e=document.getElementById("dateInput");e&&(e.value=(new Date).toISOString().slice(0,10).replace(/-/g,""))}),"undefined"!=typeof window&&(window.loadSingleFile=function(){return r(this,null,function*(){var e;const t=null==(e=document.getElementById("singleRom").files)?void 0:e[0];if(!t)return b("Bitte eine 16-Bit-EPROM-Datei auswählen."),yield $(0,"Fehler: Keine Datei ausgewählt",!0),!1;try{const e=yield t.arrayBuffer();return i=new Uint8Array(e),a=i.length,d=t.name,l=!1,b(`16-Bit-ROM geladen: ${t.name} (${a} bytes)`),a>6&&252===i[6]&&M(),E(),!0}catch(e){return b(`Datei kann nicht geladen werden: ${e}`),yield $(0,"Fehler beim Laden",!0),!1}})},window.loadDualFiles=function(){return r(this,null,function*(){var e,t;const r=document.getElementById("oddRom"),d=document.getElementById("evenRom"),u=null==(e=r.files)?void 0:e[0],h=null==(t=d.files)?void 0:t[0];if(!u||!h)return b("Bitte beide 8-Bit-EPROM-Dateien auswählen."),yield $(0,"Fehler: Dateien fehlen",!0),!1;try{const[e,t]=yield Promise.all([u.arrayBuffer(),h.arrayBuffer()]),r=new Uint8Array(e),d=new Uint8Array(t);r.length!==d.length&&(b("ODD- und EVEN-Dateigrößen unterscheiden sich; mit minimaler Länge fortfahren."),yield $(10,"Warnung: Unterschiedliche Größen",!0));const s=Math.min(r.length,d.length),y=new Uint8Array(2*s);for(let e=0;e<s;e++)y[2*e]=r[e],y[2*e+1]=d[e];return i=y,a=y.length,l=n(),o=u.name,c=h.name,b(`Duale 8-Bit geladen -> kombiniert (${a} bytes)`),a>6&&252===i[6]&&M(),E(),!0}catch(e){return b(`Duale Dateien können nicht geladen werden: ${e}`),yield $(0,"Fehler beim Laden",!0),!1}})},window.patchEPROM=function(){return r(this,null,function*(){if(0===i.length)return b("Keine ROM geladen"),yield $(0,"Fehler: Keine ROM geladen",!0),!1;const e=document.getElementById("dateInput"),t=document.getElementById("zlInput"),n=e.value.trim(),a=t.value.trim();if(!n||!a)return b("Bitte Datum und Zulassungsnummer eingeben."),yield $(0,"Fehler: Eingaben fehlen",!0),!1;b("Patch-Prozess starten..."),yield $(10,"Starte Patch-Prozess...");try{D=u;let e=yield I(D);-1===e?(b("Kann Checksumme nicht Patchen!"),yield $(20,"Fehler: Checksumme nicht gefunden",!0)):(D=h,yield C(e,4),b(`Checksumme lautet: $${e.toString(16).toUpperCase()}\nWert: ${Array.from(D).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(20,"Checksumme gepatcht")),D=s,e=yield I(D),-1===e?(b("Kann Datum ID-Chip nicht Patchen!"),yield $(30,"Fehler: Datum ID-Chip nicht gefunden",!0)):(D=y,yield C(e,14),b(`PatchDatum lautet: $${e.toString(16).toUpperCase()}\nWert: ${Array.from(D).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(30,"Datum ID-Chip gepatcht")),D=g,e=yield I(D),-1===e?(b("Kann Zulassung ID-Chip nicht Patchen!"),yield $(40,"Fehler: Zulassung nicht gefunden",!0)):(D=m,yield C(e,16),b(`Zulassung lautet: $${e.toString(16).toUpperCase()}\nWert: ${Array.from(D).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(40,"Zulassung gepatcht")),D=f,e=yield I(D),-1!==e?(D=A,yield C(e,8),b(`PatchInitRam 1 lautet: $${e.toString(16).toUpperCase()}\nWert: ${Array.from(D).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(50,"Init-Ram gepatcht")):(D=p,e=yield I(D),-1!==e?(D=U,yield C(e,8),b(`PatchInitRam 2 lautet: $${e.toString(16).toUpperCase()}\nWert: ${Array.from(D).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(50,"Init-Ram gepatcht")):(b("Kann Init-Ram Typ1 u. 2 nicht Patchen!"),yield $(50,"Fehler: Init-Ram nicht gefunden",!0))),D=T,e=yield I(D),-1===e?(b("Kann DATUM - UHR Teil1 nicht finden!"),yield $(60,"Fehler: DATUM-UHR Teil1 nicht gefunden",!0)):(D=new Uint8Array([32]),yield C(e+T.length,1),b(`DatumUhr 1 lautet: $${e.toString(16).toUpperCase()}\nWert: ${Array.from(D).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(60,"DATUM-UHR Teil1 gepatcht"));const t=new Uint8Array([e>>24&255,e>>16&255,e>>8&255,255&e]);D=t,e=yield I(D),-1===e?(b(`Kann DATUM - UHR Teil2 nicht finden! Wert: ${Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(70,"Fehler: DATUM-UHR Teil2 nicht gefunden",!0)):(D=new Uint8Array([0,0]),yield C(e+14,2),b(`DatumUhr 2 lautet: $${(e+14).toString(16).toUpperCase()}\nWert: ${Array.from(D).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(70,"DATUM-UHR Teil2 gepatcht"));const S=1048320;if(i.length>S){D=w,yield C(S,40);const e=_(n);for(let t=0;t<4;t++)i[S+t]=e[t];b(`Fester Block gepatcht bei 0x${S.toString(16).toUpperCase()}`);const t=parseInt(a),r=new Uint8Array([t>>24&255,t>>16&255,t>>8&255,255&t]);for(let e=0;e<4;e++)i[S+26+e]=r[e];b(`Fester Block gepatcht bei 0x${(S+26).toString(16).toUpperCase()}\nWert: ${Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")}`),yield $(90,"Fester Block gepatcht")}else b("ROM zu klein für festen Block"),yield $(90,"Fehler: ROM zu klein",!0);return b("Patchen abgeschlossen."),yield $(100,"Patchen abgeschlossen"),yield function(){return r(this,null,function*(){if(0===i.length)return;const e=new Blob([i.buffer],{type:"application/octet-stream"}),t=URL.createObjectURL(e),n=document.createElement("a");if(l){const e=new Uint8Array(i.length/2),t=new Uint8Array(i.length/2);for(let n=0;n<e.length;n++)e[n]=i[2*n],t[n]=i[2*n+1];const n=new Blob([e],{type:"application/octet-stream"}),r=new Blob([t],{type:"application/octet-stream"}),a=URL.createObjectURL(n),l=URL.createObjectURL(r),d=document.createElement("a"),u=document.createElement("a");d.href=a,d.download=o.replace(/\.[^.]+$/,"")+"_patched.ic10",d.click(),u.href=l,u.download=c.replace(/\.[^.]+$/,"")+"_patched.ic14",u.click(),URL.revokeObjectURL(a),URL.revokeObjectURL(l),b(`Gepatchte Dateien gespeichert: ${d.download}, ${u.download}`),yield $(100,"Dateien gespeichert")}else n.href=t,n.download=d.replace(/\.[^.]+$/,"")+"_patched.bin",n.click(),b(`Gepatchte Datei gespeichert: ${n.download}`),yield $(100,"Datei gespeichert");URL.revokeObjectURL(t)})}(),!0}catch(e){return b(`Fehler beim Patchen: ${e}`),yield $(0,"Fehler beim Patchen",!0),!1}})})})();